$().ready(function(){function a(a){if(a.id){var b=a.element[0].attributes.getNamedItem("data-destination-name");return b?b.value:a.text}var c=a.element[0].attributes.getNamedItem("data-country-code").value;return"<img class='flagSelectDestination flagCountrySmall' src='http://www.geonames.org/flags/x/"+c.toLowerCase()+".gif'/>"+a.text}function b(){$("#containerAddDestination button").prop("disabled",!0),$.sortaleElement.option("disabled",!0),$.editableElement.not(".editable-open").editable("disable"),$("[data-toggle=confirmation]").prop("disabled",!0),$(".radio input").attr("disabled",!0)}function c(){$("#containerAddDestination button").prop("disabled",!1),$.sortaleElement.option("disabled",!1),$.editableElement.editable("enable"),$("[data-toggle=confirmation]").prop("disabled",!1),$(".radio input").removeAttr("disabled")}function d(){$("[data-toggle=confirmation]").confirmation({popout:!0}),$(".btnDeleteStage").on("click",function(a){$(this).html('<i class="fa fa-spinner fa-spin"></i>'),b();var k=removeStageUrl.replace("0",$(this).data("stageId"));$.post(k,function(a){m.Load({locations:a.maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}),i(a.statsView),j(a.destinationListView),d(),g(),h(),e(),f(),c()},"json")})}function e(){$('[data-toggle="tooltip"]').tooltip()}function f(){$.material.radio($(".radio > label > input[type=radio]")),$(".priceJourney").on("click",function(a){var b=$(this).data("stageId"),c=$('.stageStyleJourneyRow[data-stage-id="'+b+'"]');if(0==c.size()){var d=$(this).data("voyageId");c=$('.stageStyleJourneyRow[data-voyage-id="'+d+'"]')}0!=c.size()&&(c.hasClass("rowHidden")?($(".stageStyleJourneyRow").addClass("rowHidden"),c.removeClass("rowHidden")):($(".stageStyleJourneyRow").addClass("rowHidden"),c.addClass("rowHidden")))}),$(".stageStyleJourneyRow .radio input").on("change",function(a){if($(this).is(":checked")){var k={transportType:$(this).val()},l=$(this).data("stageId"),n="";if(l)n=changeTransportTypeStageUrl.replace(0,l);else{var o=$(this).data("voyageId");n=changeTransportTypeVoyageUrl.replace(0,o)}b(),$.post(n,k,function(a){m.Load({locations:a.maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}),i(a.statsView),j(a.destinationListView),d(),g(),h(),e(),f(),c()},"json")}})}function g(){$.sortaleElement=Sortable.create(listDestinations,{animation:200,handle:".drag-handle",onUpdate:function(a){var k=a.item;if(a.newIndex!=a.oldIndex){var l=k.dataset.stageId,n={newPosition:a.newIndex,oldPosition:a.oldIndex},o=changePositionStageUrl.replace(0,l);b(),$.post(o,n,function(a){m.Load({locations:a.maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}),i(a.statsView),j(a.destinationListView),d(),g(),h(),e(),f(),c()},"json")}}})}function h(){$.editableElement=$(".nbDaysStage").editable({type:"select",url:changeNbDaysStageUrl,validate:function(a){if($(this).data("value")!=a){var c=$(this).data("pk"),d=$('.stagePrice[data-stage-id="'+c+'"]');d.html('<i class="fa fa-spinner fa-spin"></i>'),b()}},success:function(a,b){$.updateNavBarInfos(),i(a.statsView),j(a.destinationListView),d(),g(),h(),e(),f(),c()},inputclass:"selectEditable",source:[{value:1,text:"1 jour"},{value:2,text:"2 jours"},{value:3,text:"3 jours"},{value:4,text:"4 jours"},{value:5,text:"5 jours"},{value:6,text:"6 jours"},{value:7,text:"7 jours"},{value:8,text:"8 jours"},{value:9,text:"9 jours"},{value:10,text:"10 jours"},{value:11,text:"11 jours"},{value:12,text:"12 jours"},{value:13,text:"13 jours"},{value:14,text:"14 jours"},{value:15,text:"15 jours"},{value:16,text:"16 jours"},{value:17,text:"17 jours"},{value:18,text:"18 jours"},{value:19,text:"19 jours"},{value:20,text:"20 jours"},{value:21,text:"21 jours"},{value:22,text:"22 jours"},{value:23,text:"23 jours"},{value:24,text:"24 jours"},{value:25,text:"25 jours"},{value:26,text:"26 jours"},{value:27,text:"27 jours"},{value:28,text:"28 jours"},{value:29,text:"29 jours"},{value:30,text:"30 jours"},{value:35,text:"5 semaines"},{value:42,text:"6 semaines"},{value:49,text:"7 semaines"},{value:60,text:"2 mois"},{value:90,text:"3 mois"},{value:120,text:"4 mois"},{value:150,text:"5 mois"},{value:180,text:"6 mois"}]}),$(".editable-click").on("click",function(a){var b=$(this).data("pk"),c=$('.spanPrices[data-stage-id="'+b+'"]');c.addClass("hidden")}),$(".editable").on("hidden",function(a){var b=$(this).data("pk"),c=$('.spanPrices[data-stage-id="'+b+'"]');c.removeClass("hidden")})}function i(a){var b=$("#dashboardStatsContainer");b.empty(),b.append(a)}function j(a){var b=$("#dashboardDestinationsListContainer");b.empty(),b.append(a)}var k=$("#numberDays"),l=$("#containerAddDestination #addDestination");$(".destination").select2({formatResult:a,formatSelection:a,escapeMarkup:function(a){return a},placeholder:"Choisir une destination",theme:"bootstrap"}),$("#containerAddDestination button").on("click",function(a){$("#errorBlockDestination_addDestination").addClass("hidden"),l.val()||$("#errorBlockDestination_addDestination").removeClass("hidden")}),$("#containerAddDestination form").submit(function(a){a.preventDefault();var n={nbDays:k.val(),destinationId:l.val()};if(""!==n.destinationId){$("#containerAddDestination form button").button("loading"),b();var o=addStageUrl.replace("0",n.destinationId);$.post(o,n,function(a){m.Load({locations:a.maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}),i(a.statsView),j(a.destinationListView),d(),g(),h(),e(),f(),c(),k.val(7),l.val(""),$("#containerAddDestination form button").button("reset"),l.val(null).trigger("change"),$("#containerAddDestination form").find(".form-group").removeClass("has-error")},"json")}});var m=null;$(document).ready(function(){m=new Maplace({locations:maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}).Load(),d(),g(),h(),e(),f(),c()}),$.fn.editableform.buttons='<button type="submit" class="btn btn-primary btn-raised btn-sm editable-submit"><i class="fa fa-check"></i></button><button type="button" class="btn btn-default btn-raised btn-sm editable-cancel"><i class="fa fa-times"></i></button>',$.fn.editable.defaults.mode="inline",$.fn.editableform.loading='<div><i class="fa fa-spinner fa-spin"></i></div>',$(window).scroll(function(){var a=$(window).scrollTop();a>$("#siteHeader").height()?$("#headerDashboard").addClass("stickyHeader"):$("#headerDashboard").removeClass("stickyHeader")}),$("#showPricesInPublic").on("change",function(){var a={showPricesInPublic:this.checked};$("#showPricesInPublic").attr("disabled",!0),$.post(voyageCRUDUpdateShowPricesInPublicUrl,a,function(a){$("#showPricesInPublic").removeAttr("disabled")},"json")})}),$().ready(function(){function a(){var a=$("#deparatureDate #deparatureDateContainer").datepicker("getDate"),b={name:$("#voyageName").val(),deparatureDate:a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),destinationId:$("#updateVoyageModal #updateDestination").val()};$.post(voyageCRUDUpdateUrl,b,function(a){document.location.href=a.nextUri},"json")}$(document).ready(function(){var a=$("#updateVoyageModal .select2");a.width("100%"),$("#voyageName").val(currentVoyageName),$("#updateVoyageModal select").val(currentStartDestinationId).trigger("change"),$("#deparatureDate #deparatureDateContainer").datepicker({language:"fr",format:"dd-mm-yyyy",todayHighlight:!0}),$("#deparatureDate #deparatureDateContainer").datepicker("setDate",currentStartDate)}),$("#updateVoyageModal #_submitUpdateForm").on("click",function(){$hasError=!1,$("#voyageName").val()?$("#errorBlockName").addClass("hidden"):($hasError=!0,$("#errorBlockName").removeClass("hidden"));var b=$("#deparatureDate #deparatureDateContainer").datepicker("getDate");b?$("#errorBlockDeparatureDate").addClass("hidden"):($hasError=!0,$("#errorBlockDeparatureDate").removeClass("hidden")),$("#updateVoyageModal #updateDestination").val()?$("#errorBlockDestination").addClass("hidden"):($hasError=!0,$("#errorBlockDestination").removeClass("hidden")),$hasError||($(this).parent().children().addClass("disabled"),a())})});