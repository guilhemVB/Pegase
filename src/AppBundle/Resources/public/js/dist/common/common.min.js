$().ready(function(){$(function(){$('[data-toggle="tooltip"]').tooltip()}),$.material.init(),$(".columnsFooter").masonry({itemSelector:".country",columnWidth:".country",percentPosition:!0})});var map=function(a){var b={mymap:null,mapName:"map",info:null,informationOnOverEnabled:!1,clickAction:function(){}},c=this,d="#0C9915";this.construct=function(a){$.extend(b,a),b.mymap=L.map(b.mapName),f(),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:accessTokenMapbox}).addTo(b.mymap),b.info=L.control()},this.printCountries=function(a,d){a=a||null,d=d||[],$.getJSON(geoJsonMapPath,function(e){$.each(e.features,function(a){var b=e.features[a];b.properties.price=b.properties.totalPrices.toFixed(0),b.selected=!1}),e.features=jQuery.grep(e.features,function(a){return a.properties.price}),L.geoJson(e,{style:h,onEachFeature:a}).addTo(b.mymap),f(),c.selectCountries(d)})},this.selectCountries=function(a){$.each(b.mymap._layers,function(c){var d=b.mymap._layers[c];if(d.feature&&d.feature.properties.ISO_A3){var f=d.feature.properties.ISO_A3;a.indexOf(f)>-1&&e(d)}})};var e=function(a){a.options.fillColor!=d?(a.feature.selected=!0,a.setStyle({fillColor:d})):(a.setStyle(h(a.feature)),a.feature.selected=!1)},f=function(){b.mymap.setView([23.872326,10.586547],2)},g=function(a){return null==a?"#B3B191":a>50?"#B37631":a>40?"#C98C47":a>30?"#D4A36C":a>20?"#DEBA90":"#E9D1B5"},h=function(a){return{fillColor:g(a.properties.price),weight:1,opacity:1,color:"white",dashArray:"3",fillOpacity:.7}},i=function(a){var c=a.target;c.setStyle({weight:3,color:"#666",dashArray:"",fillOpacity:.7}),L.Browser.ie||L.Browser.opera||L.Browser.edge||c.bringToFront(),b.informationOnOverEnabled&&b.info.update(c.feature.properties)},j=function(a){var c=a.target;c.setStyle({weight:1,opacity:1,color:"white",dashArray:"3",fillOpacity:.7}),b.informationOnOverEnabled&&b.info.update()};this.setClickActionSelectCountry=function(){b.clickAction=function(a){e(a.target)}},this.setClickActionFollowURL=function(){b.clickAction=function(a){window.location.href=a.target.feature.properties.viewUrl}},this.onEachFeatureCountry=function(a,c){c.on({mouseover:i,mouseout:j,click:b.clickAction})},this.enableLegend=function(a){var c=L.control({position:"bottomleft"});c.onAdd=function(b){for(var c=L.DomUtil.create("div","info legend"),e=[10,20,30,40,50],f=0;f<e.length;f++)c.innerHTML+='<i style="background:'+g(e[f]+1)+'"></i>'+e[f]+(e[f+1]?" à "+e[f+1]+" €<br>":"+ €");return a&&(c.innerHTML+='<br><i style="background:'+d+'"></i> Selectionné'),c},c.addTo(b.mymap)},this.enableInformationOnOver=function(){b.informationOnOverEnabled=!0,b.info.onAdd=function(a){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},b.info.update=function(a){this._div.innerHTML=a?"<b>"+a.name+" - "+a.price+'€/jour</b>  <img src="http://www.geonames.org/flags/x/'+a.codeAlpha2.toLowerCase()+'.gif" class="flagCountrySmall flagGmap flagGmapInfo pull-right" alt="drapeau '+a.name+'">':"Survoler un pays"},b.info.addTo(b.mymap)};var k=function(a,c,d){var e=L.icon({iconUrl:a.icon,iconSize:[12,20],iconAnchor:[6,20],popupAnchor:[0,-20]}),f=L.marker([a.lat,a.lon],{icon:e,onEachFeature:d}).addTo(b.mymap);c&&f.bindPopup(a.html)};this.printDestinations=function(a,c){c=c||null,$.getJSON(getDestinationsInfoUrl,function(d){var e=null,f=null,g=null,h=null;$.each(d,function(b){var i=d[b];k(i,a,c),null==e?(g=i.lat,h=i.lat,e=i.lon,f=i.lon):(i.lat>g&&(g=i.lat),i.lat<h&&(h=i.lat),i.lon>e&&(e=i.lon),i.lon<f&&(f=i.lon))}),b.mymap.fitBounds([[g+1,f-1],[h-1,e+1]]),1==d.length&&b.mymap.setZoom(9)})},this.getSelectedCountries=function(){var a=[];return $.each(b.mymap._layers,function(c){var d=b.mymap._layers[c];d.feature&&d.selected&&a.push(d.selected)}),a},this.construct(a)};