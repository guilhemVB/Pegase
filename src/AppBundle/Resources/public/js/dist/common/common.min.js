$().ready(function(){$(function(){$('[data-toggle="tooltip"]').tooltip()}),$.material.init(),$(".columnsFooter").masonry({itemSelector:".country",columnWidth:".country",percentPosition:!0})});var map=function(a){var b={mymap:null,mapName:"map",info:null,informationOnOverEnabled:!1,clickAction:function(){}};this.construct=function(a){$.extend(b,a),b.mymap=L.map(b.mapName),c(),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:accessTokenMapbox}).addTo(b.mymap),b.info=L.control()},this.printCountries=function(a){a=a||null,$.getJSON(geoJsonMapPath,function(d){$.each(d.features,function(a){var b=d.features[a];b.properties.price=b.properties.totalPrices.toFixed(0)}),d.features=jQuery.grep(d.features,function(a){return a.properties.price}),L.geoJson(d,{style:e,onEachFeature:a}).addTo(b.mymap),c()})};var c=function(){b.mymap.setView([23.872326,10.586547],2)},d=function(a){return null==a?"#B3B191":a>50?"#B37631":a>40?"#C98C47":a>30?"#D4A36C":a>20?"#DEBA90":"#E9D1B5"},e=function(a){return{fillColor:d(a.properties.price),weight:1,opacity:1,color:"white",dashArray:"3",fillOpacity:.7}},f=function(a){var c=a.target;c.setStyle({weight:3,color:"#666",dashArray:"",fillOpacity:.7}),L.Browser.ie||L.Browser.opera||L.Browser.edge||c.bringToFront(),b.informationOnOverEnabled&&b.info.update(c.feature.properties)},g=function(a){var c=a.target;c.setStyle({weight:1,opacity:1,color:"white",dashArray:"3",fillOpacity:.7}),b.informationOnOverEnabled&&b.info.update()};this.setClickActionSelectCountry=function(){b.clickAction=function(a){var b="#0C9915",c=a.target;c.options.fillColor!=b?c.setStyle({fillColor:b}):c.setStyle(e(c.feature))}},this.setClickActionFollowURL=function(){b.clickAction=function(a){window.location.href=a.target.feature.properties.viewUrl}},this.onEachFeatureCountry=function(a,c){c.on({mouseover:f,mouseout:g,click:b.clickAction})},this.enableLegend=function(){var a=L.control({position:"bottomleft"});a.onAdd=function(a){for(var b=L.DomUtil.create("div","info legend"),c=[10,20,30,40,50],e=0;e<c.length;e++)b.innerHTML+='<i style="background:'+d(c[e]+1)+'"></i>'+c[e]+(c[e+1]?" à "+c[e+1]+" €<br>":"+ €");return b},a.addTo(b.mymap)},this.enableInformationOnOver=function(){b.informationOnOverEnabled=!0,b.info.onAdd=function(a){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},b.info.update=function(a){this._div.innerHTML=a?"<b>"+a.name+" - "+a.price+'€/jour</b><img src="http://www.geonames.org/flags/x/'+a.codeAlpha2.toLowerCase()+'.gif" class="flagCountrySmall flagGmap pull-right" alt="drapeau '+a.name+'">':"Survoler un pays"},b.info.addTo(b.mymap)};var h=function(a,c){var d=L.icon({iconUrl:a.icon,iconSize:[12,20],iconAnchor:[6,20],popupAnchor:[0,-20]}),e=L.marker([a.lat,a.lon],{icon:d}).addTo(b.mymap);c&&e.bindPopup(a.html)};this.printDestinations=function(a){$.getJSON(getDestinationsInfoUrl,function(c){console.log(c);var d=null,e=null,f=null,g=null;$.each(c,function(b){var i=c[b];h(i,a),null==d?(f=i.lat,g=i.lat,d=i.lon,e=i.lon):(i.lat>f&&(f=i.lat),i.lat<g&&(g=i.lat),i.lon>d&&(d=i.lon),i.lon<e&&(e=i.lon))}),b.mymap.fitBounds([[f+1,e-1],[g-1,d+1]]),1==c.length&&b.mymap.setZoom(9)})},this.construct(a)};