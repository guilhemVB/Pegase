{% set activeDashboard = true %}
{% extends "::layout.html.twig" %}


{% block title %}
    {{ voyage.name }} - tableau de bord - {{ parent() }}
{% endblock %}


{% block stylesheets %}
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="{{ asset('/css/select2-bootstrap.min.css') }}">
    {{ parent() }}
    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"
          rel="stylesheet"/>
{% endblock %}


{% block body %}
    <div id="dashboard">


        <div class="container-fluid">
            <div class="container">

                <div class="row">
                    <div class="col-md-12">
                        <h1>{{ voyage.name }}</h1>
                    </div>
                </div>

                <div class="row" style="padding: 30px">
                    <div class="col-md-12">
                        <div id="gmap"></div>
                    </div>
                </div>

            </div>
        </div>


        <div class="container-fluid" id="containerAddDestination">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <h3>Ajouter une destination</h3>

                                <form class="form-inline">
                                    <div class="form-group">
                                        <label for="destination">Destination</label>
                                        {% include 'AppBundle:Destination:selectDestination.html.twig' %}
                                    </div>
                                    <div class="form-group">
                                        <label for="numberDays">Nombre de jours</label>
                                        {% include 'AppBundle:Destination:selectNbDays.html.twig' %}
                                    </div>
                                    <button type="submit" class="btn btn-default btn-success"
                                            data-loading-text="Chargement ...">
                                        <i class="fa fa-plus"></i> Ajouter
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-fluid" style="padding-bottom: 30px">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h3>Liste des destinations</h3>
                    </div>
                    <div class="col-md-12">
                        <ul id="listDestinations">
                            {% for stage in stagesSorted %}
                                {% include 'AppBundle:Voyage:stage.html.twig' %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-fluid containerBlue">
            <div class="container">

                <div class="row">
                    <div class="col-md-12">
                        <h3>Tableau de bord de votre voyage</h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <blockquote>
                            <h4>
                                Nombre d'étapes<span
                                        class="pull-right label label-danger">{{ voyageStats.nbStages }}</span>
                            </h4>
                            <h4>
                                Coût moyen estimé, sans transport<span
                                        class="pull-right label label-danger">{{ voyageStats.totalCost }}€</span>
                            </h4>
                            <h4>
                                Durée du voyage<span class="pull-right label label-danger">
                            {{ voyageStats.nbDays }} jour{% if voyageStats.nbDays > 1 %}s{% endif %}</span>
                            </h4>
                            <h4>
                                Date de départ<span
                                        class="pull-right label label-danger">{{ voyageStats.startDate|date("d/m/Y") }}</span>
                            </h4>
                            <h4>
                                Date de retour<span
                                        class="pull-right label label-danger">{{ voyageStats.endDate|date("d/m/Y") }}</span>
                            </h4>
                            <h4>
                                Nombre de pays traversés<span
                                        class="pull-right label label-danger">{{ voyageStats.nbCountries }}</span>
                            </h4>
                            <h4>
                                Distance parcourue à vol d'oiseau <span
                                        class="pull-right label label-danger">{{ voyageStats.crowFliesDistance|round }}
                                    km</span>
                            </h4>
                        </blockquote>
                    </div>
                    <div class="col-md-6">
                        Date de départ
                    </div>
                </div>

            </div>
        </div>


    </div>
{% endblock %}


    {% block javascripts %}
        <script src="http://maps.google.com/maps/api/js?sensor=false&libraries=geometry&v=3.7"></script>
        {{ parent() }}
        <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
        <script src="//cdn.jsdelivr.net/sortable/1.2.1/Sortable.min.js"></script>
        <script src="{{ asset('/js/maplace.js') }}"></script>
        <script>
            var maplaceData = {{ maplaceData|raw }};
            var changePositionStageUrl = "{{ path('changePositionStage', {'id' : 0}) }}";
            var addStageUrl = "{{ path('addStage', {'id' : 0}) }}";
            var removeStageUrl = "{{ path('removeStage', {'id' : 0}) }}";

            $.fn.editable.defaults.mode = 'inline';
            $(document).ready(function () {
                $('.nbDaysStage').editable({
                    type: 'select',
                    url: "{{ path('changeNbDaysStage') }}",
                    validate: function (value) {
                        var stageId = $(this).data('pk');
                        var $stagePrice = $('.stagePrice[data-stage-id="' + stageId + '"]');
                        $stagePrice.html('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;');
                        $stagePrice.addClass('editableform-loading');
                    },
                    success: function (response, newValue) {
                        var $stagePrice = $('.stagePrice[data-stage-id="' + response.stageId + '"]');
                        $stagePrice.removeClass('editableform-loading');
                        var priceHtml = response.stagePrice + ' €';
                        $stagePrice.html(priceHtml);
                    },
                    source: [
                        {value: 1, text: '1 jour'},
                        {value: 2, text: '2 jours'},
                        {value: 3, text: '3 jours'},
                        {value: 4, text: '4 jours'},
                        {value: 5, text: '5 jours'},
                        {value: 6, text: '6 jours'},
                        {value: 7, text: '7 jours'},
                        {value: 8, text: '8 jours'},
                        {value: 9, text: '9 jours'},
                        {value: 10, text: '10 jours'},
                        {value: 11, text: '11 jours'},
                        {value: 12, text: '12 jours'},
                        {value: 13, text: '13 jours'},
                        {value: 14, text: '14 jours'},
                        {value: 15, text: '15 jours'},
                        {value: 16, text: '16 jours'},
                        {value: 17, text: '17 jours'},
                        {value: 18, text: '18 jours'},
                        {value: 19, text: '19 jours'},
                        {value: 20, text: '20 jours'},
                        {value: 21, text: '21 jours'},
                        {value: 22, text: '22 jours'},
                        {value: 23, text: '23 jours'},
                        {value: 24, text: '24 jours'},
                        {value: 25, text: '25 jours'},
                        {value: 26, text: '26 jours'},
                        {value: 27, text: '27 jours'},
                        {value: 28, text: '28 jours'},
                        {value: 29, text: '29 jours'},
                        {value: 30, text: '30 jours'},
                        {value: 31, text: '31 jours'},
                        {value: 32, text: '32 jours'},
                        {value: 33, text: '33 jours'},
                        {value: 34, text: '34 jours'},
                        {value: 35, text: '35 jours'},
                        {value: 36, text: '36 jours'},
                        {value: 37, text: '37 jours'},
                        {value: 38, text: '38 jours'},
                        {value: 39, text: '39 jours'},
                        {value: 40, text: '40 jours'},
                        {value: 41, text: '41 jours'},
                        {value: 42, text: '42 jours'},
                        {value: 43, text: '43 jours'},
                        {value: 44, text: '44 jours'},
                        {value: 45, text: '45 jours'},
                        {value: 46, text: '46 jours'},
                        {value: 47, text: '47 jours'},
                        {value: 48, text: '48 jours'},
                        {value: 49, text: '49 jours'},
                        {value: 50, text: '50 jours'},
                        {value: 51, text: '51 jours'},
                        {value: 52, text: '52 jours'},
                        {value: 53, text: '53 jours'},
                        {value: 54, text: '54 jours'},
                        {value: 55, text: '55 jours'},
                        {value: 56, text: '56 jours'},
                        {value: 57, text: '57 jours'},
                        {value: 58, text: '58 jours'},
                        {value: 59, text: '59 jours'},
                        {value: 60, text: '60 jours'}
                    ]
                });
            });

        </script>
        <script src="{{ asset('bundles/app/js/dashboard/dashboard.js') }}"></script>

    {% endblock %}


