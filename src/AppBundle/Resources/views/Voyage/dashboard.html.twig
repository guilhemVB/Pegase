{% set activeDashboard = true %}
{% extends "::layout.html.twig" %}


{% block title %}
    {{ voyage.name }} - tableau de bord - {{ parent() }}
{% endblock %}


{% block stylesheets %}
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="{{ asset('/css/select2-bootstrap.min.css') }}">
    {{ parent() }}
    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"
          rel="stylesheet"/>
{% endblock %}


{% block body %}
    <div id="dashboard">


        <div class="container-fluid">
            <div class="container">

                <div class="row">
                    <div class="col-md-12">
                        <h1>{{ voyage.name }}</h1>
                    </div>
                </div>

                <div class="row" style="padding-top: 30px; padding-bottom: 30px;">
                    <div class="col-md-12">
                        <div id="gmap"></div>
                    </div>
                </div>

            </div>
        </div>


        <div class="container-fluid" id="containerAddDestination">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <h3 id="addDestinationHeader">Ajouter une destination</h3>

                                <form class="form-inline">
                                    <div class="form-group">
                                        <label for="destination">Destination</label>
                                        {% include 'AppBundle:Destination:selectDestination.html.twig' %}
                                    </div>
                                    <div class="form-group">
                                        <label for="numberDays">Nombre de jours</label>
                                        {% include 'AppBundle:Destination:selectNbDays.html.twig' %}
                                    </div>
                                    <button type="submit" class="btn btn-default btn-success"
                                            data-loading-text="Chargement ...">
                                        <i class="fa fa-plus"></i> Ajouter
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-fluid" style="padding-bottom: 30px">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        {% if stagesSorted|length > 0 %}
                            <h3>Liste des destinations</h3>
                        {% else %}
                            <h3>Aucune destination</h3>
                        {% endif %}
                    </div>
                    <div class="col-md-12">
                        <ul id="listDestinations">
                            {% for stage in stagesSorted %}
                                {% include 'AppBundle:Voyage:stage.html.twig' %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-fluid containerBlue" id="containerStats">
            <div class="container">

                <div class="row">
                    <div class="col-lg-4">
                        <h3 class="text-center">
                            <span class="label label-warning">{{ voyageStats.nbDays }}
                                jour{% if voyageStats.nbDays > 1 %}s{% endif %}</span>
                        </h3>
                        <blockquote class="col-lg-10 col-lg-offset-1">
                            <p>
                                Date de départ <span class="pull-right">{{ voyageStats.startDate|date("d/m/Y") }}</span>
                            </p>
                            <p>
                                Date de retour <span class="pull-right">{{ voyageStats.endDate|date("d/m/Y") }}</span>
                            </p>
                        </blockquote>
                    </div>

                    <div class="col-lg-4">
                        <h3 class="text-center">
                            <span class="label label-success">{{ voyageStats.totalCost|number_format(0, ',', ' ') }} &euro;</span>
                        </h3>
                        <blockquote class="col-lg-8 col-lg-offset-2">
                            <p>
                                Logement <span class="pull-right">{{ voyageStats.totalCostAccommodation|number_format(0, ',', ' ') }} &euro;</span>
                            </p>
                            <p>
                                Autre <span class="pull-right">{{ voyageStats.totalCostLifeCost|number_format(0, ',', ' ') }} &euro;</span>
                            </p>
                        </blockquote>
                    </div>

                    <div class="col-lg-4">
                        <h3 class="text-center">
                            <span class="label label-danger">{{ voyageStats.nbStages }}
                                étape{% if voyageStats.nbStages > 0 %}s{% endif %}</span>
                        </h3>
                        <blockquote class="col-lg-10 col-lg-offset-1">
                            <p>
                                Nombre de pays <span class="pull-right">{{ voyageStats.nbCountries }} pays</span>
                            </p>
                            <p>
                                Distance parcourue <span class="pull-right">
                                    {{ voyageStats.crowFliesDistance|round|number_format(0, ',', ' ') }} km
                                </span>
                            </p>
                        </blockquote>
                    </div>
                </div>

            </div>
        </div>


    </div>
{% endblock %}


    {% block javascripts %}
        <script src="http://maps.google.com/maps/api/js?sensor=false&libraries=geometry&v=3.7"></script>
        {{ parent() }}
        <script
                src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
        <script src="//cdn.jsdelivr.net/sortable/1.2.1/Sortable.min.js"></script>
        <script src="{{ asset('/js/maplace.js') }}"></script>
        <script>
            var maplaceData = {{ maplaceData|raw }};
            var changePositionStageUrl = "{{ path('changePositionStage', {'id' : 0}) }}";
            var addStageUrl = "{{ path('addStage', {'id' : 0}) }}";
            var removeStageUrl = "{{ path('removeStage', {'id' : 0}) }}";
            var changeNbDaysStageUrl = "{{ path('changeNbDaysStage') }}";
        </script>
        <script src="{{ asset('bundles/app/js/dashboard/dashboard.js') }}"></script>

    {% endblock %}


