$().ready(function(){function a(a){if(a.id){var b=a.element[0].attributes.getNamedItem("data-destination-name");return b?b.value:a.text}var c=a.element[0].attributes.getNamedItem("data-country-code").value;return"<img class='flagSelectDestination flagCountrySmall' src='http://www.geonames.org/flags/x/"+c.toLowerCase()+".gif'/>"+a.text}function b(){$("#containerAddDestination button").prop("disabled",!0),$.sortaleElement.option("disabled",!0),$.editableElement.not(".editable-open").editable("disable"),$("[data-toggle=confirmation]").prop("disabled",!0)}function c(){$("#containerAddDestination button").prop("disabled",!1),$.sortaleElement.option("disabled",!1),$.editableElement.editable("enable"),$("[data-toggle=confirmation]").prop("disabled",!1)}function d(a){var b=$("#dashboardStatsContainer");b.empty(),b.append(a)}function e(a){$.each(a,function(a,b){var c=$('.stageStars[data-stage-id="'+a+'"]'),d=$('.stageStartDate[data-stage-id="'+a+'"]');c.html(b.starsView),d.html(b.dateFromFormated)})}$("[data-toggle=confirmation]").confirmation({popout:!0});var f=null,g=$("#numberDays"),h=$("#containerAddDestination #addDestination");$(".destination").select2({formatResult:a,formatSelection:a,escapeMarkup:function(a){return a},placeholder:"Choisir une destination",theme:"bootstrap"}),$("#containerAddDestination button").on("click",function(a){$("#errorBlockDestination_addDestination").addClass("hidden"),h.val()||$("#errorBlockDestination_addDestination").removeClass("hidden")}),$("#containerAddDestination form").submit(function(a){a.preventDefault();var c={nbDays:g.val(),destinationId:h.val()};if(""!==c.destinationId){$("#containerAddDestination form button").button("loading"),b();var d=addStageUrl.replace("0",c.destinationId);$.post(d,c,function(a){window.location.reload()},"json")}}),$(".btnDeleteStage").on("click",function(a){$(this).html('<i class="fa fa-spinner fa-spin"></i>'),b();var c=removeStageUrl.replace("0",$(this).data("stageId"));$.post(c,function(a){window.location.reload()},"json")}),$.fn.editableform.buttons='<button type="submit" class="btn btn-primary btn-raised btn-sm editable-submit"><i class="fa fa-check"></i></button><button type="button" class="btn btn-default btn-raised btn-sm editable-cancel"><i class="fa fa-times"></i></button>',$.fn.editable.defaults.mode="inline",$.fn.editableform.loading='<div><i class="fa fa-spinner fa-spin"></i></div>',$(document).ready(function(){f=new Maplace({locations:maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}).Load(),$.sortaleElement=Sortable.create(listDestinations,{animation:200,handle:".drag-handle",onUpdate:function(a){var g=a.item;if(a.newIndex!=a.oldIndex){var h=g.dataset.stageId,i={newPosition:a.newIndex,oldPosition:a.oldIndex},j=changePositionStageUrl.replace(0,h);b(),$.post(j,i,function(a){c(),f.Load({locations:a.maplaceData,map_div:"#gmap",controls_on_map:!1,type:"polyline"}),e(a.voyageStats.stagesStats),d(a.statsView)},"json")}}}),$.editableElement=$(".nbDaysStage").editable({type:"select",url:changeNbDaysStageUrl,validate:function(a){if($(this).data("value")!=a){var c=$(this).data("pk"),d=$('.stagePrice[data-stage-id="'+c+'"]');d.html('<i class="fa fa-spinner fa-spin"></i>'),b()}},success:function(a,b){$.updateNavBarInfos(),c(),d(a.statsView);var f=$('.stagePrice[data-stage-id="'+a.stageId+'"]'),g=a.stagePrice+" &euro;";f.html('<span class="label label-success">'+g+"</span>"),e(a.voyageStats.stagesStats),$('[data-toggle="tooltip"]').tooltip()},inputclass:"selectEditable",source:[{value:1,text:"1 jour"},{value:2,text:"2 jours"},{value:3,text:"3 jours"},{value:4,text:"4 jours"},{value:5,text:"5 jours"},{value:6,text:"6 jours"},{value:7,text:"7 jours"},{value:8,text:"8 jours"},{value:9,text:"9 jours"},{value:10,text:"10 jours"},{value:11,text:"11 jours"},{value:12,text:"12 jours"},{value:13,text:"13 jours"},{value:14,text:"14 jours"},{value:15,text:"15 jours"},{value:16,text:"16 jours"},{value:17,text:"17 jours"},{value:18,text:"18 jours"},{value:19,text:"19 jours"},{value:20,text:"20 jours"},{value:21,text:"21 jours"},{value:22,text:"22 jours"},{value:23,text:"23 jours"},{value:24,text:"24 jours"},{value:25,text:"25 jours"},{value:26,text:"26 jours"},{value:27,text:"27 jours"},{value:28,text:"28 jours"},{value:29,text:"29 jours"},{value:30,text:"30 jours"},{value:31,text:"31 jours"},{value:32,text:"32 jours"},{value:33,text:"33 jours"},{value:34,text:"34 jours"},{value:35,text:"5 semaines"},{value:42,text:"6 semaines"},{value:49,text:"7 semaines"},{value:56,text:"8 semaines"},{value:60,text:"2 mois"},{value:90,text:"3 mois"},{value:120,text:"4 mois"},{value:150,text:"5 mois"},{value:180,text:"6 mois"}]}),$('[data-toggle="tooltip"]').tooltip(),c()}),$(window).scroll(function(){var a=$(window).scrollTop();a>$("#siteHeader").height()?$("#headerDashboard").addClass("stickyHeader"):$("#headerDashboard").removeClass("stickyHeader")})}),$().ready(function(){function a(){var a=$("#deparatureDate #deparatureDateContainer").datepicker("getDate"),b={name:$("#voyageName").val(),deparatureDate:a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),destinationId:$("#updateVoyageModal #updateDestination").val()};$.post(voyageCRUDUpdateUrl,b,function(a){document.location.href=a.nextUri},"json")}$(document).ready(function(){var a=$("#updateVoyageModal .select2");a.width("100%"),$("#voyageName").val(currentVoyageName),$("#updateVoyageModal select").val(currentStartDestinationId).trigger("change"),$("#deparatureDate #deparatureDateContainer").datepicker({language:"fr",format:"dd-mm-yyyy",todayHighlight:!0}),$("#deparatureDate #deparatureDateContainer").datepicker("setDate",currentStartDate)}),$("#updateVoyageModal #_submitUpdateForm").on("click",function(){$hasError=!1,$("#voyageName").val()?$("#errorBlockName").addClass("hidden"):($hasError=!0,$("#errorBlockName").removeClass("hidden"));var b=$("#deparatureDate #deparatureDateContainer").datepicker("getDate");b?$("#errorBlockDeparatureDate").addClass("hidden"):($hasError=!0,$("#errorBlockDeparatureDate").removeClass("hidden")),$("#updateVoyageModal #updateDestination").val()?$("#errorBlockDestination").addClass("hidden"):($hasError=!0,$("#errorBlockDestination").removeClass("hidden")),$hasError||($(this).parent().children().addClass("disabled"),a())})});